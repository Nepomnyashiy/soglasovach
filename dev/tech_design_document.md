### Архитектурное Видение и Проектное Решение (Technical Design Document)
**Проект: B2B SaaS "Согласовач"**
**Версия: 1.0**

#### 1. Введение

**1.1. Цель Документа**
Настоящий документ определяет высокоуровневую архитектуру, технологический стек, ключевые проектные решения и методологию разработки платформы "Согласовач". Он является основой для принятия технических решений и руководством для команды разработки.

**1.2. Бизнес-контекст**
"Согласовач" — это B2B SaaS-платформа, предназначенная для автоматизации, управления и анализа корпоративных процессов согласования. Цель системы — заменить медленные, непрозрачные и подверженные ошибкам ручные процессы на управляемый цифровой конвейер, снижая операционные издержки и повышая эффективность бизнеса.

#### 2. Ключевые Архитектурные Принципы

В основе архитектуры лежат принципы, описанные в ведущей инженерной литературе:

*   **Domain-Driven Design (DDD):** Наша модель данных (Сущности: `Workflow`, `Process`, `User` и т.д.) является ядром нашего "Единого Языка" (Ubiquitous Language). Вся логика строится вокруг этой доменной модели.
*   **API-First & Decoupling:** Бэкенд и фронтенд являются полностью разделенными приложениями. Контрактом между ними служит строго специфицированный REST/GraphQL API. Это позволяет вести параллельную разработку и заменять компоненты независимо друг от друга (принцип из **"Микросервисы. От архитектуры до релиза"**).
*   **Scalability & Resilience:** Архитектура изначально проектируется с расчетом на горизонтальное масштабирование и отказоустойчивость. Мы избегаем единых точек отказа и проектируем сервисы как stateless, где это возможно (принципы из **"Высоконагруженные приложения" (DDIA)** и **"Инженерия надёжности сайтов" (SRE)**).
*   **DevOps Culture & Automation:** CI/CD является не дополнением, а фундаментальной частью процесса разработки. Наша цель — достижение элитных показателей производительности, описанных в книге **"Ускоряйся! Наука DevOps"**: быстрое время от коммита до развертывания и низкий процент сбоев.

#### 3. Архитектура и Технологический Стек

Система строится на базе микросервисной архитектуры.

*   **3.1. Бэкенд**
    *   **Технологии:** **Python 3.11+**, **FastAPI**, **Pydantic**, **SQLAlchemy 2.0** (в асинхронном режиме).
    *   **Подход:** Вся бизнес-логика реализуется в виде сервисного слоя на Python. Мы используем идиоматичный и строго типизированный код (**"Fluent Python"**, **"Чистый Python"**), что упрощает поддержку. SQLAlchemy предоставляет мощный ORM для взаимодействия с БД, абстрагируя нас от написания сырых SQL-запросов.

*   **3.2. Фронтенд**
    *   **Технологии:** **React 18+** с **TypeScript**, сборщик **Vite**, UI-библиотека **Material-UI** (для быстрого создания профессионального B2B-интерфейса), state manager **Zustand** (за его простоту и эффективность).

*   **3.3. База Данных**
    *   **Технологии:** **PostgreSQL 15+**.
    *   **Роль:** Исключительно хранение данных и обеспечение их целостности через механизмы `FOREIGN KEY`, `UNIQUE`, `CHECK constraints` и транзакции. **Бизнес-логика в виде хранимых процедур и триггеров БД не используется.**

*   **3.4. Инфраструктурные компоненты**
    *   **Кэш и Очереди:** **Redis** (для кэширования сессий, данных и как брокер для фоновых задач).
    *   **Хранилище Файлов:** **Minio** (S3-совместимое объектное хранилище).

#### 4. Реализация Ключевых Механизмов

*   **4.1. Движок Процессов (Workflow Engine)**
    *   **Подход:** Будет реализован в бэкенде как конечный автомат (State Machine). Сервисный слой (`WorkflowService`) будет отвечать за переходы `ProcessInstance` между этапами (`Steps`).
    *   **Триггеры и Действия:** Переход состояния будет публиковать внутреннее событие (in-process event). Специальные сервисы-слушатели (Listeners) будут отлавливать эти события и, если условия `Trigger`'а выполняются, запускать соответствующий `Action` (например, вызывать `TaskService` для создания задачи). Такая схема обеспечивает слабую связанность (loose coupling).

*   **4.2. Иерархия и Права Доступа (Permissions)**
    *   **Подход:** Логика проверки прав и обхода иерархии (например, "найти руководителя инициатора") будет инкапсулирована в отдельных сервисах (`PermissionService`, `UserService`). Это позволит централизованно управлять логикой и покрывать ее юнит-тестами.

#### 5. Инструменты и DevOps

*   **5.1. Контроль Версий:** **Git** (с использованием методологии Feature Branches и Pull Requests).
*   **5.2. Контейнеризация:** **Docker** и **Docker Compose** для локальной разработки и тестирования.
*   **5.3. CI/CD (Непрерывная Интеграция и Доставка):** **GitHub Actions**.
    *   **Workflow Pipeline:**
        1.  **Linting & Formatting:** Запуск `ruff` и `prettier` для проверки стиля кода.
        2.  **Static Analysis:** Запуск `mypy` для статической типизации Python-кода.
        3.  **Testing:** Запуск `pytest` для выполнения юнит- и интеграционных тестов.
        4.  **Build:** Сборка Docker-образов.
        5.  **Deploy:** Автоматическое развертывание в staging-окружение.
*   **5.4. Качество Кода:**
    *   **Принцип:** Мы следуем заветам **"Чистого Кода"** и **"Совершенного Кода"**. Код должен быть читаемым, самодокументируемым и покрытым тестами. Любой Pull Request может быть влит в основную ветку только после успешного прохождения всех проверок CI и ревью кода.
